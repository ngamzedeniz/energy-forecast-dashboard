<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forecast Results: {{ city }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .footer {
            margin-top: 50px;
            padding: 20px 0;
            border-top: 1px solid #eee;
            color: #6c757d;
            font-size: 0.85em;
            text-align: center;
        }
        .card-stat {
            background-color: #f8f9fa;
            border-left: 5px solid #0d6efd;
            border-radius: .5rem;
        }
        .insight-card {
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.95em;
            background-color: #e9ecef;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body class="bg-light">
<div class="container mt-5 p-4 bg-white rounded shadow-lg">
    <h1 class="mb-4 text-primary fw-bold">Dashboard: {{ city }} Energy Forecast</h1>
    
    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
        <p class="text-danger">A critical API error occurred. Please check server logs for details on the Met Office/OpenMeteo failure.</p>
    {% else %}

    <div class="row mb-5">
        <div class="col-md-4">
            <div class="card card-stat p-3 h-100">
                <h5 class="text-muted">Instant Demand Forecast</h5>
                <p class="fs-3 text-primary fw-bold">{{ predicted_demand }} <span class="text-muted fs-6">Unit</span></p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-stat p-3 h-100">
                <h5 class="text-muted">Avg. Actual Temperature</h5>
                <p class="fs-3 fw-bold text-warning">{{ avg_temp }} <span class="text-muted fs-6">°C</span></p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-stat p-3 h-100">
                <h5 class="text-muted">Avg. Spot Price (Sim.)</h5>
                <p class="fs-3 fw-bold text-success">{{ avg_price }} <span class="text-muted fs-6">EUR</span></p>
            </div>
        </div>
    </div>
    
    <h3 class="mb-3 text-secondary">Meteorological & Market Insight</h3>
    <div class="card p-3 mb-5 insight-card">
        <p class="mb-0">{{ interpretation }}</p>
    </div>

    <h3 class="mb-3 text-secondary">Interactive Charts</h3>
    
    <div class="card mb-4 p-3">{{ demand_plot | safe }}</div>
    
    <div class="row">
        <div class="col-md-6"><div class="card mb-4 p-3">{{ weather_plot | safe }}</div></div>
        <div class="col-md-6"><div class="card mb-4 p-3">{{ market_plot | safe }}</div></div>
    </div>
    
    <h3 class="mb-3 text-secondary">Detailed Hourly Data (Forecast Region)</h3>
    <div class="table-responsive">
        <table class="table table-sm table-hover small">
            <thead class="table-primary">
            <tr>
                <th>Time (UTC)</th>
                <th>Stacking Forecast</th>
                <th>Actual Demand</th>
                <th>Actual Temp (°C)</th>
                <th>Actual Wind Speed (m/s)</th>
                <th>Sim. Spot Price (EUR)</th>
                <th>Sim. Wind Gen. (MW)</th>
            </tr>
            </thead>
            <tbody>
            {% for row in table_rows %}
            <tr>
                <td>{{ row.Time }}</td>
                <td>{{ row.Final_Stacking_Prediction }}</td>
                <td>{{ row.Target_Actual }}</td>
                <td>{{ row.Actual_Temp_C }}</td>
                <td>{{ row.Actual_WindSpeed }}</td>
                <td>{{ row.SpotPrice_EUR }}</td>
                <td>{{ row.WindGen_MW }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <a href="/" class="btn btn-secondary mt-3">← Run New Forecast</a>
</div>

<div class="footer">
    Developer: <strong>{{ developer }}</strong> | <a href="https://www.linkedin.com/in/nursima-gamze-deniz/" target="_blank">LinkedIn Profile</a> | Powered by FastAPI, Plotly & Advanced ML
</div>

</body>
</html>
